<!--
=======================================================================
Nano Banana専用 イラストフィギュア化プロンプトビルダー v1.0.0
Author: てんねん (@munou_ac)

このコードの無断転載・再配布を固く禁じます。
=======================================================================
-->
<html lang="ja">
<head><meta content="noindex, nofollow" name="robots"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-lang-key="pageTitle">Nano Banana専用 イラストフィギュア化プロンプトビルダー</title>
<!-- Tailwind CSS is removed and bundled styles are below -->
<style type="text/css">
    /* Tailwind CSS Preflight (Reset) */
    *,::before,::after { box-sizing: border-box; border-width: 0; border-style: solid; border-color: #e5e7eb }
    html { line-height: 1.5; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; }
    body { margin: 0; line-height: inherit }
    hr { height: 0; color: inherit; border-top-width: 1px }
    h1,h2,h3,h4,h5,h6 { font-size: inherit; font-weight: inherit }
    a { color: inherit; text-decoration: inherit }
    b,strong { font-weight: bolder }
    code,kbd,samp,pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 1em }
    small { font-size: 80% }
    sub,sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline }
    sub { bottom: -0.25em }
    sup { top: -0.5em }
    table { text-indent: 0; border-color: inherit; border-collapse: collapse }
    button,input,optgroup,select,textarea { font-family: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; color: inherit; margin: 0; padding: 0 }
    button,select { text-transform: none }
    button,[type='button'],[type='reset'],[type='submit'] { -webkit-appearance: button; background-color: transparent; background-image: none }
    :-moz-focusring { outline: auto }
    :-moz-ui-invalid { box-shadow: none }
    progress { vertical-align: baseline }
    ::-webkit-inner-spin-button,::-webkit-outer-spin-button { height: auto }
    [type='search'] { -webkit-appearance: textfield; outline-offset: -2px }
    ::-webkit-search-decoration { -webkit-appearance: none }
    ::-webkit-file-upload-button { -webkit-appearance: button; font: inherit }
    summary { display: list-item }
    blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre { margin: 0 }
    fieldset { margin: 0; padding: 0 }
    legend { padding: 0 }
    ol,ul,menu { list-style: none; margin: 0; padding: 0 }
    textarea { resize: vertical }
    input::placeholder,textarea::placeholder { opacity: 1; color: #9ca3af }
    button,[role="button"] { cursor: pointer }
    :disabled { cursor: default }
    img,svg,video,canvas,audio,iframe,embed,object { display: block; vertical-align: middle }
    img,video { max-width: 100%; height: auto }
    [hidden] { display: none }

    /* Custom and Utility Styles from the page */
    .checkbox-container { display: flex; align-items: center; margin-bottom: 1rem; }
    .checkbox-container input[type="checkbox"] { margin-right: 0.5rem; }
    input:disabled + label { color: #64748b; cursor: not-allowed; }
    #consent-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
    #consent-overlay.show { display: flex; }
    .consent-dialog { background-color: #1e293b; padding: 2rem; border-radius: 1rem; border: 1px solid #334155; width: 90%; max-width: 600px; }
    .lang-btn.active { background-color: #38bdf8; color: white; font-weight: 600; }

    .bg-slate-900 { background-color: #0f172a; }
    .bg-slate-800 { background-color: #1e293b; }
    .bg-slate-700 { background-color: #334155; }
    .bg-slate-600 { background-color: #475569; }
    .bg-amber-500\/10 { background-color: rgba(245, 158, 11, 0.1); }
    .bg-blue-600 { background-color: #2563eb; }
    .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
    .bg-sky-600 { background-color: #0284c7; }
    .hover\:bg-sky-700:hover { background-color: #0369a1; }
    .hover\:bg-slate-500:hover { background-color: #64748b; }
    .bg-transparent { background-color: transparent; }

    .text-gray-100 { color: #f3f4f6; }
    .text-blue-400 { color: #60a5fa; }
    .text-slate-400 { color: #94a3b8; }
    .text-slate-500 { color: #64748b; }
    .text-slate-300 { color: #cbd5e1; }
    .text-amber-200 { color: #fde68a; }
    .text-amber-300 { color: #fcd34d; }
    .text-white { color: #fff; }
    .text-emerald-300 { color: #6ee7b7; }
    .text-emerald-400 { color: #34d399; }
    .text-red-400 { color: #f87171; }
    .text-slate-200 { color: #e2e8f0; }
    .text-amber-400 { color: #fbbf24; }
    
    .font-sans { font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; }
    .font-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .text-center { text-align: center; }
    .leading-relaxed { line-height: 1.625; }
    .tracking-wider { letter-spacing: 0.05em; }
    
    .min-h-screen { min-height: 100vh; }
    .w-full { width: 100%; }
    .max-w-2xl { max-width: 42rem; }
    .w-8 { width: 2rem; }
    .h-8 { height: 2rem; }
    .w-5 { width: 1.25rem; }
    .h-5 { height: 1.25rem; }
    .w-4 { width: 1rem; }
    .h-4 { height: 1rem; }
    .h-24 { height: 6rem; }
    .h-48 { height: 12rem; }
    .max-h-\[50vh\] { max-height: 50vh; }

    .py-10 { padding-top: 2.5rem; padding-bottom: 2.5rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .p-8 { padding: 2rem; }
    .p-4 { padding: 1rem; }
    .p-3 { padding: 0.75rem; }
    .p-2 { padding: 0.5rem; }
    .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .pr-20 { padding-right: 5rem; }
    .pr-2 { padding-right: 0.5rem; }
    .pl-6 { padding-left: 1.5rem; }
    .pl-4 { padding-left: 1rem; }
    .pl-2 { padding-left: 0.5rem; }

    .m-1 { margin: 0.25rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mt-1 { margin-top: 0.25rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-2 { margin-top: 0.5rem; }
    .my-4 { margin-top: 1rem; margin-bottom: 1rem; }
    .my-6 { margin-top: 1.5rem; margin-bottom: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    .pt-6 { padding-top: 1.5rem; }
    .mr-3 { margin-right: 0.75rem; }
    .mt-0\.5 { margin-top: 0.125rem; }
    .mr-2 { margin-right: 0.5rem; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-1 { margin-left: 0.25rem; }
    
    .flex { display: flex; }
    .inline-flex { display: inline-flex; }
    .grid { display: grid; }
    .hidden { display: none; }
    .block { display: block; }
    .items-start { align-items: flex-start; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .justify-end { justify-content: flex-end; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .flex-col { flex-direction: column; }
    .flex-wrap { flex-wrap: wrap; }
    .flex-shrink-0 { flex-shrink: 0; }
    .space-y-1 > :not([hidden]) ~ :not([hidden]) { margin-top: calc(0.25rem * 1); margin-bottom: calc(0.25rem * 0); }
    .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: calc(0.5rem * 1); margin-bottom: calc(0.5rem * 0); }
    .space-y-3 > :not([hidden]) ~ :not([hidden]) { margin-top: calc(0.75rem * 1); margin-bottom: calc(0.75rem * 0); }

    .rounded-2xl { border-radius: 1rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .rounded-md { border-radius: 0.375rem; }
    .rounded-full { border-radius: 9999px; }
    .rounded { border-radius: 0.25rem; }
    .border { border-width: 1px; }
    .border-slate-700 { border-color: #334155; }
    .border-amber-500\/30 { border-color: rgba(245, 158, 11, 0.3); }
    .border-l { border-left-width: 1px; }
    .border-slate-600 { border-color: #475569; }
    .border-t { border-top-width: 1px; }
    
    .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
    .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }

    .overflow-y-auto { overflow-y: auto; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .top-2 { top: 0.5rem; }
    .right-2 { right: 0.5rem; }

    .list-disc { list-style-type: disc; }
    .list-inside { list-style-position: inside; }

    .transition-colors { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .duration-200 { transition-duration: 200ms; }

    .transform { transform: translate(0, 0) rotate(0) skewX(0) skewY(0) scaleX(1) scaleY(1); }
    .hover\:scale-105:hover { transform: scale(1.05); }

    .cursor-pointer { cursor: pointer; }
    .resize-y { resize: vertical; }
    .resize-none { resize: none; }

    .hover\:text-slate-300:hover { color: #cbd5e1; }
    .hover\:text-blue-400:hover { color: #60a5fa; }

    .form-checkbox { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 0; -webkit-print-color-adjust: exact; color-adjust: exact; display: inline-block; vertical-align: middle; background-origin: border-box; -webkit-user-select: none; -moz-user-select: none; user-select: none; flex-shrink: 0; height: 1rem; width: 1rem; color: #4f46e5; background-color: #fff; border-color: #6b7280; border-width: 1px; border-radius: 0.25rem; }
    .form-checkbox:checked { background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e"); border-color: transparent; background-color: currentColor; background-size: 100% 100%; background-position: center; background-repeat: no-repeat; }
    .form-radio { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding: 0; -webkit-print-color-adjust: exact; color-adjust: exact; display: inline-block; vertical-align: middle; background-origin: border-box; -webkit-user-select: none; -moz-user-select: none; user-select: none; flex-shrink: 0; border-radius: 100%; height: 1rem; width: 1rem; color: #4f46e5; background-color: #fff; border-color: #6b7280; border-width: 1px; }
    .form-radio:checked { background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e"); border-color: transparent; background-color: currentColor; background-size: 100% 100%; background-position: center; background-repeat: no-repeat; }

    .text-blue-500 { color: #3b82f6; }
    .focus\:ring-blue-500:focus { --tw-ring-color: #3b82f6; }

    .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
    .focus\:ring-2:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
    .focus\:ring-offset-2:focus { --tw-ring-offset-width: 2px; }
    .focus\:ring-offset-slate-800:focus { --tw-ring-offset-color: #1e293b; }

    .ring-1 { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
    .ring-white\/10 { --tw-ring-color: rgba(255, 255, 255, 0.1); }
    
    .fill-none { fill: none; }
    .fill-currentColor { fill: currentColor; }
    .stroke-currentColor { stroke: currentColor; }
    .stroke-width-2 { stroke-width: 2; }
    
    @media (min-width: 640px) {
        .sm\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .sm\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .sm\:flex-row { flex-direction: row; }
    }
</style>
</head>
<body class="bg-slate-900 text-gray-100 min-h-screen py-10 px-4 font-sans flex items-start justify-center">
<div class="w-full max-w-2xl bg-slate-800 p-8 rounded-2xl shadow-lg border border-slate-700">
    <div class="flex justify-center items-center gap-3 mb-2">
        <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0 2c-2.21 0-4 1.79-4 4v1h8v-1c0-2.21-1.79-4-4-4zm6 4h-2v-1c0-1.33-1.07-2.42-2.41-2.92C15.02 10.48 16 9.35 16 8c0-2.21-1.79-4-4-4S8 5.79 8 8c0 1.35.98 2.48 2.41 2.92C9.07 11.58 8 12.67 8 14v1H6c-1.1 0-2 .9-2 2v2h16v-2c0-1.1-.9-2-2-2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
         <h1 class="text-3xl font-bold text-center text-blue-400" data-lang-key="appTitle" data-lang-type="html">Nano Banana専用<br/>イラストフィギュア化プロンプトビルダー</h1>
    </div>
    <p class="text-center text-slate-400 mb-4" data-lang-key="appSubtitle">各項目を選択して、イラストをフィギュア化するためのプロンプトを組み立てます。</p>

    <div class="text-center mb-6">
        <button class="lang-btn px-3 py-1 text-sm rounded-md bg-slate-700 transition-colors" data-lang="ja">日本語</button>
        <button class="lang-btn px-3 py-1 text-sm rounded-md bg-slate-600 transition-colors" data-lang="en">English</button>
    </div>

    <div class="mb-6 p-4 rounded-lg border border-amber-500/30 bg-amber-500/10 text-amber-200 text-sm">
        <div class="flex items-start">
            <svg class="h-5 w-5 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <div>
                <p class="font-semibold" data-lang-key="recSettingsTitle">【推奨設定】</p>
                <p class="mt-1 leading-relaxed" data-lang-key="recSettingsText" data-lang-type="html">このビルダーで作成したプロンプトの意図をAIに正確に反映させるため、Nano Bananaのモデル設定で <strong class="font-semibold text-amber-300">TemperatureとTop Pをそれぞれ「0」</strong> に設定することを強く推奨します。</p>
            </div>
        </div>
    </div>
    
    <!-- Aspect Ratio Section -->
    <div class="mb-4 p-4 rounded-lg border border-slate-700 bg-slate-700" id="aspect-ratio-section">
        <h2 class="text-lg font-semibold text-slate-300 mb-2 flex items-center gap-2">
             <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 8V6a2 2 0 012-2h2M3 16v2a2 2 0 002 2h2M19 8V6a2 2 0 00-2-2h-2M19 16v2a2 2 0 01-2 2h-2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <span data-lang-key="aspectRatioTitle">アスペクト比</span>
        </h2>
        <div class="flex items-center gap-4 mb-4">
            <label class="flex items-center text-slate-400">
                <input checked="" class="form-radio text-blue-500 focus:ring-blue-500" name="aspect-ratio-option" type="radio" value="match"/>
                <span class="ml-2" data-lang-key="aspectMatch">参照画像に合わせる</span>
            </label>
            <label class="flex items-center text-slate-400">
                <input class="form-radio text-blue-500 focus:ring-blue-500" name="aspect-ratio-option" type="radio" value="change"/>
                <span class="ml-2" data-lang-key="aspectChange">アスペクト比を変更する</span>
            </label>
        </div>
        <div class="hidden" id="aspect-ratio-controls">
            <div class="text-sm text-slate-400 mb-4 leading-relaxed">
                <p class="mb-2" data-lang-key="aspectDownloadDesc">生成画像の縦横比を変えたい場合は、ここから希望のアスペクト比の「アスペクト比指定画像」をダウンロードしてください。</p>
                <div class="text-xs space-y-2 my-4 p-3 bg-slate-900 rounded-lg">
                    <p class="font-semibold text-slate-300" data-lang-key="aspectNotesTitle">【補足事項】</p>
                    <ul class="list-disc list-inside pl-2 space-y-1">
                        <li data-lang-key="aspectNote1">各アスペクト比の画像は、一度ダウンロードすれば繰り返し使えます。</li>
                        <li data-lang-key="aspectNote2">モデルの特性上、必ずしも指定通りのアスペクト比で生成されるとは限りません。</li>
                        <li data-lang-key="aspectNote3">アスペクト比を変更する際は、構図が崩れにくくなる「パッケージなし」かつ「背景なしかスタジオ」での生成を推奨します。</li>
                    </ul>
                </div>
                <div class="bg-slate-900 p-3 rounded-lg">
                    <strong class="text-slate-200" data-lang-key="aspectImportantTitle" data-lang-type="html">【重要】Nano Bananaでのアップロード順:</strong><br/>
                    <p class="my-1 text-xs" data-lang-key="aspectImportantDesc">最後にアップロードした画像の縦横比が適用されます。</p>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-xs sm:text-sm" data-lang-key="aspectImportantList" data-lang-type="html">
                        <li><strong>通常の場合:</strong><br/><span class="pl-4 font-mono">1. イラスト → 2. アスペクト比指定画像</span></li>
                        <li><strong>ロゴ画像を使う場合:</strong><br/><span class="pl-4 font-mono">1. ロゴ画像 → 2. イラスト → 3. アスペクト比指定画像</span></li>
                    </ul>
                </div>
            </div>
            <div class="mt-4 mb-2">
                 <button class="w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all duration-200 flex items-center justify-center gap-2" id="download-all-aspects-btn">
                     <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                     <span data-lang-key="aspectDownloadAll">全てを一括ダウンロード</span>
                 </button>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="aspect-ratio-buttons">
                <!-- Buttons are generated by JavaScript -->
            </div>
        </div>
    </div>
    <!-- Package Options -->
    <div class="mb-4 p-4 rounded-lg border border-slate-700 bg-slate-700">
        <h2 class="text-lg font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <span data-lang-key="packageTitle">パッケージオプション</span>
        </h2>
        <div class="checkbox-container">
            <input class="form-checkbox text-blue-500 rounded focus:ring-blue-500" id="include-package" type="checkbox"/>
            <label class="text-slate-400" for="include-package" data-lang-key="packageCheck">背景にパッケージを置く</label>
        </div>
        <div class="hidden pl-6 border-l border-slate-600" id="package-options-container">
            <div class="mb-2">
                <label class="block text-sm font-medium text-slate-300 mb-1" for="package-text" data-lang-key="packageTextLabel">パッケージへの文字入力:</label>
                <input class="w-full p-2 rounded-lg bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500" id="package-text" data-lang-key="packageTextInput" data-lang-type="placeholder" placeholder="例：フィギュア名" type="text"/>
            </div>
            <div class="checkbox-container">
                <input class="form-checkbox text-blue-500 rounded focus:ring-blue-500" id="use-image-as-texture" type="checkbox"/>
                <label class="text-slate-400" for="use-image-as-texture" data-lang-key="packageTextureCheck">参照画像をテクスチャとして使用</label>
            </div>
            <div class="checkbox-container">
                <input class="form-checkbox text-blue-500 rounded focus:ring-blue-500" id="include-logo" type="checkbox"/>
                <label class="text-slate-400" for="include-logo" data-lang-key="packageLogoCheck">ロゴを追加する</label>
            </div>
            <div class="hidden mt-4" id="logo-options-container">
                <div class="mb-2">
                    <label class="block text-sm font-medium text-slate-300 mb-1" data-lang-key="logoTypeLabel">ロゴのタイプを選択:</label>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center text-slate-400">
                            <input checked="" class="form-radio text-blue-500 focus:ring-blue-500" name="logo-type" type="radio" value="image"/>
                            <span class="ml-2" data-lang-key="logoTypeImage">ロゴ画像を配置</span>
                        </label>
                        <label class="flex items-center text-slate-400">
                            <input class="form-radio text-blue-500 focus:ring-blue-500" name="logo-type" type="radio" value="text"/>
                            <span class="ml-2" data-lang-key="logoTypeText">テキストで生成</span>
                        </label>
                    </div>
                </div>
                <div class="mt-2" id="logo-image-instructions">
                    <p class="text-sm text-slate-400 mb-2 leading-relaxed bg-slate-900 p-3 rounded-lg" data-lang-key="logoImageInstructions" data-lang-type="html">
                        <strong class="text-slate-200">【重要】ロゴ画像の使い方:</strong><br/>
                        Nano Bananaで、以下の順番で画像をアップロードしてください。<br/>
                        <strong class="text-amber-400 font-mono">1. ロゴにしたい画像</strong><br/>
                        <strong class="text-amber-400 font-mono">2. フィギュア化するイラスト</strong><br/>
                        <span class="text-xs">(アスペクト比を変える場合は、最後にアスペクト比指定画像をアップロード)</span>
                    </p>
                </div>
                <div class="hidden mt-2" id="logo-text-container">
                    <label class="block text-sm font-medium text-slate-300 mb-1" for="logo-text" data-lang-key="logoTextLabel">ロゴ用文字入力:</label>
                    <input class="w-full p-2 rounded-lg bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500" id="logo-text" data-lang-key="logoTextInput" data-lang-type="placeholder" placeholder="例：ブランド名" type="text"/>
                </div>
            </div>
        </div>
    </div>
    <!-- Background Options -->
    <div class="mb-4 p-4 rounded-lg border border-slate-700 bg-slate-700">
        <h2 class="text-lg font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
           <span data-lang-key="backgroundTitle">背景オプション</span>
        </h2>
        <div class="checkbox-container">
            <input class="form-checkbox text-blue-500 rounded focus:ring-blue-500" id="include-background" type="checkbox"/>
            <label class="text-slate-400" for="include-background" data-lang-key="backgroundCheck">背景を置く</label>
        </div>
        <div class="hidden pl-6 border-l border-slate-600" id="background-options-container">
            <div class="mb-2">
                <label class="block text-sm font-medium text-slate-300 mb-1" data-lang-key="backgroundTypeLabel">背景プリセット:</label>
                <div class="flex flex-wrap gap-4">
                    <label class="flex items-center text-slate-400">
                        <input checked="" class="form-radio text-blue-500 focus:ring-blue-500" name="background-type" type="radio" value="studio"/>
                        <span class="ml-2" data-lang-key="bgTypeStudio">スタジオ</span>
                    </label>
                    <label class="flex items-center text-slate-400">
                        <input class="form-radio text-blue-500 focus:ring-blue-500" name="background-type" type="radio" value="shop"/>
                        <span class="ml-2" data-lang-key="bgTypeShop">ショップ</span>
                    </label>
                    <label class="flex items-center text-slate-400">
                        <input class="form-radio text-blue-500 focus:ring-blue-500" name="background-type" type="radio" value="desk"/>
                        <span class="ml-2" data-lang-key="bgTypeDesk">机の上</span>
                    </label>
                    <label class="flex items-center text-slate-400">
                        <input class="form-radio text-blue-500 focus:ring-blue-500" name="background-type" type="radio" value="diorama"/>
                        <span class="ml-2" data-lang-key="bgTypeDiorama">ジオラマ</span>
                    </label>
                    <label class="flex items-center text-slate-400">
                        <input class="form-radio text-blue-500 focus:ring-blue-500" name="background-type" type="radio" value="other"/>
                        <span class="ml-2" data-lang-key="bgTypeOther">その他</span>
                    </label>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-slate-300 mb-1" for="background-prompt-input" data-lang-key="backgroundPromptLabel">背景プロンプト (編集可能):</label>
                <textarea class="w-full h-24 p-2 text-sm rounded-lg bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" id="background-prompt-input" data-lang-key="backgroundPromptInput" data-lang-type="placeholder" placeholder="自由に記述してください"></textarea>
            </div>
        </div>
    </div>
    <div class="mb-4 p-4 rounded-lg border border-slate-700 bg-slate-700">
        <div class="text-sm text-slate-300 font-semibold mb-2 flex items-center gap-2">
             <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-12v4m-2-2h4m5 10v4m-2-2h4M5 3a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V5a2 2 0 00-2-2zm14 0a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V5a2 2 0 00-2-2zM5 17a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V19a2 2 0 00-2-2zm14 0a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V19a2 2 0 00-2-2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <span data-lang-key="displayBaseTitle">展示台（display base）</span>
        </div>
        <label class="inline-flex items-center gap-2 text-sm text-slate-300">
            <input checked="checked" id="display-base-toggle" type="checkbox"/>
            <span data-lang-key="displayBaseUse">使用する</span>
        </label>
        <div class="text-xs text-slate-500 mt-1" data-lang-key="displayBaseDesc">OFFにすると展示台を非表示にします。</div>
    </div>
    <!-- Generate Button -->
    <div class="flex items-center justify-center my-6">
        <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-800 flex items-center justify-center gap-2" id="generate-prompt-btn">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-12v4m-2-2h4m5 10v4m-2-2h4M5 3a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V5a2 2 0 00-2-2zm14 0a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V5a2 2 0 00-2-2zM5 17a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V19a2 2 0 00-2-2zm14 0a2 2 0 00-2 2v1.5a2.5 2.5 0 005 0V19a2 2 0 00-2-2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <span data-lang-key="generateButton">プロンプトを組み立てる</span>
        </button>
    </div>
    <!-- Result Display Area -->
    <div class="hidden" id="result-area">
        <h2 class="text-xl font-semibold text-slate-300 mb-2" data-lang-key="resultTitle">組み立てられたプロンプト:</h2>
        <p class="text-xs text-slate-400 mb-2" data-lang-key="resultSubtitle"></p>
        <div class="relative">
            <textarea class="w-full h-48 p-3 pr-20 text-sm rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y" id="prompt-output"></textarea>
            <button class="absolute top-2 right-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-3 rounded-lg text-xs transition-all duration-200 flex items-center gap-1" id="copy-prompt-btn">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span data-lang-key="copyButton">コピー</span>
            </button>
        </div>
    </div>
    <div class="mt-6 mb-4 p-4 rounded-lg border border-slate-700 bg-slate-700" id="batch-helper">
        <div class="text-sm text-slate-300 font-semibold flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" stroke-linecap="round" stroke-linejoin="round"></path></svg>
            <span data-lang-key="variationTitle">バリエーション作成</span>
        </div>
        <p class="text-xs text-slate-400 mt-2" data-lang-key="variationSubtitle">作成したいバリエーションのタイプを選択してください。</p>
        <div class="mt-3 flex flex-col sm:flex-row gap-4">
            <label class="flex items-center text-slate-400">
                <input checked="" class="form-radio text-blue-500 focus:ring-blue-500" name="batch-variation-type" type="radio" value="angle"/>
                 <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span class="ml-1 text-sm" data-lang-key="variationAngle">カメラ角度バリエーション</span>
            </label>
            <label class="flex items-center text-slate-400">
                <input class="form-radio text-blue-500 focus:ring-blue-500" name="batch-variation-type" type="radio" value="light"/>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span class="ml-1 text-sm" data-lang-key="variationLight">照明バリエーション</span>
            </label>
        </div>
        <div class="mt-4 flex gap-3 flex-wrap">
            <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow-lg transition-all flex items-center gap-2" id="batch-generate">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 14v6m-3-3h6M3 10v10a2 2 0 002 2h10v-6M3 10V3a2 2 0 012-2h10a2 2 0 012 2v6" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span data-lang-key="variationButton">バリエーションを作成</span>
            </button>
            <button class="bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-4 rounded-xl transition-all flex items-center gap-2" id="batch-download">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <span data-lang-key="downloadButton">一括 .txt ダウンロード</span>
            </button>
        </div>
        <div class="mt-4 space-y-2" id="batch-list"></div>
    </div>
    <!-- Footer with Author Info and Terms of Use -->
    <footer class="mt-8 pt-6 border-t border-slate-700 text-sm text-slate-500">
        <details class="mb-4">
            <summary class="cursor-pointer hover:text-slate-300 transition-colors" data-lang-key="termsTitle">利用上の注意</summary>
            <div class="mt-3 p-4 bg-slate-900 rounded-lg text-xs space-y-2">
                <div class="font-bold text-slate-300" data-lang-key="termsHeading">購入者限定コンテンツのご利用条件</div>
                <ul class="list-disc list-inside" data-lang-key="termsList" data-lang-type="html">
                    <li>本コンテンツは購入者本人のみが利用できます。第三者へのURL共有、転載・公開、複製・二次配布を含むあらゆる再配布行為は禁止します。</li>
                    <li>本コンテンツの利用により生じた行為・結果（生成物の公開・投稿・配布等）については、利用者ご自身の責任にてご判断・ご対応ください。</li>
                    <li>環境（ブラウザ、拡張機能、ネットワーク等）の違いにより表示・動作に差異が生じる場合があります。動作の完全性・継続性・適合性は保証いたしかねます。</li>
                    <li>コンテンツの内容・提供条件・URLは予告なく変更または停止することがあります。不正利用を確認した場合、以後の提供を停止する場合があります。</li>
                </ul>
                <div class="text-slate-400 mt-2" data-lang-key="termsDisclaimer">上記に同意いただけない場合はご利用いただけません。</div>
            </div>
        </details>
        <div class="text-center">
            <p data-lang-key="authorLabel">作者: てんねん</p>
            <div class="flex justify-center items-center gap-4 mt-2 text-sm">
                <a class="text-slate-400 hover:text-blue-400 flex items-center gap-1 transition-colors" href="https://x.com/munou_ac" rel="noopener noreferrer" target="_blank">
                    <svg class="w-4 h-4" fill="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                </a>
                <span class="text-slate-600">/</span>
                <a class="text-slate-400 hover:text-blue-400 transition-colors" href="https://note.com/munou_ac" rel="noopener noreferrer" target="_blank">note</a>
            </div>
        </div>
        <p class="text-center mt-4 text-xs">© 2025 てんねん. All Rights Reserved.</p>
        <div class="mt-6 text-center" id="license-box">
            <div class="inline-flex items-center gap-2 px-3 py-2 rounded-full bg-slate-900 ring-1 ring-white/10 shadow-sm">
                <span class="text-slate-400 text-xs">License ID</span>
                <code class="license-id text-emerald-300 text-xs font-semibold tracking-wider">NB-0000-0000</code>
            </div>
        </div>
    </footer>
</div>

<!-- Consent Modal -->
<div id="consent-overlay">
    <div class="consent-dialog">
        <h2 class="text-xl font-bold text-slate-200 mb-4">
            購入者限定コンテンツのご利用条件<br>
            <span class="text-lg text-slate-400">Terms and Conditions for Purchaser-Exclusive Content</span>
        </h2>
        <div class="text-sm text-slate-300 space-y-3 max-h-[50vh] overflow-y-auto pr-2">
            <ul class="list-disc list-inside space-y-2">
                <li>本コンテンツは購入者本人のみが利用できます。第三者へのURL共有、転載・公開、複製・二次配布を含むあらゆる再配布行為は禁止します。</li>
                <li>This content is for the exclusive use of the purchaser. Any redistribution, including sharing the URL, reprinting, publishing, duplicating, or secondary distribution, is prohibited.</li>
            </ul>
             <ul class="list-disc list-inside space-y-2">
                <li>本コンテンツの利用により生じた行為・結果（生成物の公開・投稿・配布等）については、利用者ご自身の責任にてご判断・ご対応ください。</li>
                 <li>The user is solely responsible for all actions and results arising from the use of this content (including publishing, posting, and distributing generated materials).</li>
            </ul>
            <ul class="list-disc list-inside space-y-2">
                <li>環境（ブラウザ、拡張機能、ネットワーク等）の違いにより表示・動作に差異が生じる場合があります。動作の完全性・継続性・適合性は保証いたしかねます。</li>
                <li>Display and operation may vary depending on the environment (browser, extensions, network, etc.). We do not guarantee completeness, continuity, or suitability of operation.</li>
            </ul>
             <ul class="list-disc list-inside space-y-2">
                <li>コンテンツの内容・提供条件・URLは予告なく変更または停止することがあります。不正利用を確認した場合、以後の提供を停止する場合があります。</li>
                 <li>The content, terms of provision, and URL are subject to change or discontinuation without notice. Access may be suspended if unauthorized use is detected.</li>
            </ul>
            <div class="text-red-400 font-semibold pt-2">
                <p>上記に同意いただけない場合はご利用いただけません。</p>
                <p>If you do not agree to the above terms, you may not use this content.</p>
            </div>
            <div class="pt-2 text-xs text-slate-400">License ID: <code class="license-id text-emerald-400 font-semibold">NB-0000-0000</code></div>
        </div>
        <div class="mt-6 flex justify-end gap-4">
            <button class="px-4 py-2 rounded-lg bg-slate-600 hover:bg-slate-500 text-white font-semibold transition-colors" id="consent-disagree" type="button">同意しない / Disagree</button>
            <button class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition-colors" id="consent-agree" type="button">同意する / Agree</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const translations = {
            ja: {
                pageTitle: "Nano Banana専用 イラストフィギュア化プロンプトビルダー",
                appTitle: "Nano Banana専用<br/>イラストフィギュア化プロンプトビルダー",
                appSubtitle: "各項目を選択して、イラストをフィギュア化するためのプロンプトを組み立てます。",
                recSettingsTitle: "【推奨設定】",
                recSettingsText: "このビルダーで作成したプロンプトの意図をAIに正確に反映させるため、Nano Bananaのモデル設定で <strong class=\"font-semibold text-amber-300\">TemperatureとTop Pをそれぞれ「0」</strong> に設定することを強く推奨します。",
                aspectRatioTitle: "アスペクト比",
                aspectMatch: "参照画像に合わせる",
                aspectChange: "アスペクト比を変更する",
                aspectDownloadDesc: "生成画像の縦横比を変えたい場合は、ここから希望のアスペクト比の「アスペクト比指定画像」をダウンロードしてください。",
                aspectNotesTitle: "【補足事項】",
                aspectNote1: "各アスペクト比の画像は、一度ダウンロードすれば繰り返し使えます。",
                aspectNote2: "モデルの特性上、必ずしも指定通りのアスペクト比で生成されるとは限りません。",
                aspectNote3: "アスペクト比を変更する際は、構図が崩れにくくなる「パッケージなし」かつ「背景なしかスタジオ」での生成を推奨します。",
                aspectImportantTitle: "【重要】Nano Bananaでのアップロード順:",
                aspectImportantDesc: "最後にアップロードした画像の縦横比が適用されます。",
                aspectImportantList: "<li><strong>通常の場合:</strong><br/><span class=\"pl-4 font-mono\">1. イラスト → 2. アスペクト比指定画像</span></li><li><strong>ロゴ画像を使う場合:</strong><br/><span class=\"pl-4 font-mono\">1. ロゴ画像 → 2. イラスト → 3. アスペクト比指定画像</span></li>",
                packageTitle: "パッケージオプション",
                packageCheck: "背景にパッケージを置く",
                packageTextLabel: "パッケージへの文字入力:",
                packageTextInput: "例：フィギュア名",
                packageTextureCheck: "参照画像をテクスチャとして使用",
                packageLogoCheck: "ロゴを追加する",
                logoTypeLabel: "ロゴのタイプを選択:",
                logoTypeImage: "ロゴ画像を配置",
                logoTypeText: "テキストで生成",
                logoImageInstructions: "<strong class=\"text-slate-200\">【重要】ロゴ画像の使い方:</strong><br/>Nano Bananaで、以下の順番で画像をアップロードしてください。<br/><strong class=\"text-amber-400 font-mono\">1. ロゴにしたい画像</strong><br/><strong class=\"text-amber-400 font-mono\">2. フィギュア化するイラスト</strong><br/><span class=\"text-xs\">(アスペクト比を変える場合は、最後にアスペクト比指定画像をアップロード)</span>",
                logoTextLabel: "ロゴ用文字入力:",
                logoTextInput: "例：ブランド名",
                backgroundTitle: "背景オプション",
                backgroundCheck: "背景を置く",
                backgroundTypeLabel: "背景プリセット:",
                bgTypeStudio: "スタジオ",
                bgTypeShop: "ショップ",
                bgTypeDesk: "机の上",
                bgTypeDiorama: "ジオラマ",
                bgTypeOther: "その他",
                backgroundPromptLabel: "背景プロンプト (編集可能):",
                backgroundPromptInput: "自由に記述してください",
                displayBaseTitle: "展示台（display base）",
                displayBaseUse: "使用する",
                displayBaseDesc: "OFFにすると展示台を非表示にします。",
                generateButton: "プロンプトを組み立てる",
                resultTitle: "組み立てられたプロンプト:",
                resultSubtitle: "このプロンプトは直接編集できます。コピーしてNano Bananaの入力欄に貼り付けてください。",
                copyButton: "コピー",
                copyButtonDone: "コピー完了!",
                variationTitle: "バリエーション作成",
                variationSubtitle: "作成したいバリエーションのタイプを選択してください。",
                variationAngle: "カメラ角度バリエーション",
                variationLight: "照明バリエーション",
                variationButton: "バリエーションを作成",
                downloadButton: "一括 .txt ダウンロード",
                termsTitle: "利用上の注意",
                termsHeading: "購入者限定コンテンツのご利用条件",
                termsList: "<li>本コンテンツは購入者本人のみが利用できます。第三者へのURL共有、転載・公開、複製・二次配布を含むあらゆる再配布行為は禁止します。</li><li>本コンテンツの利用により生じた行為・結果（生成物の公開・投稿・配布等）については、利用者ご自身の責任にてご判断・ご対応ください。</li><li>環境（ブラウザ、拡張機能、ネットワーク等）の違いにより表示・動作に差異が生じる場合があります。動作の完全性・継続性・適合性は保証いたしかねます。</li><li>コンテンツの内容・提供条件・URLは予告なく変更または停止することがあります。不正利用を確認した場合、以後の提供を停止する場合があります。</li>",
                termsDisclaimer: "上記に同意いただけない場合はご利用いただけません。",
                authorLabel: "作者: てんねん",
                modalTitle: "購入者限定コンテンツのご利用条件",
                modalList: "<li>本コンテンツは購入者本人のみが利用できます。第三者へのURL共有、転載・公開、複製・二次配布を含むあらゆる再配布行為は禁止します。</li><li>本コンテンツの利用により生じた行為・結果（生成物の公開・投稿・配布等）については、利用者ご自身の責任にてご判断・ご対応ください。</li><li>環境（ブラウザ、拡張機能、ネットワーク等）の違いにより表示・動作に差異が生じる場合があります。動作の完全性・継続性・適合性は保証いたしかねます。</li><li>コンテンツの内容・提供条件・URLは予告なく変更または停止することがあります。不正利用を確認した場合、以後の提供を停止する場合があります。</li>",
                modalDisclaimer: "上記に同意いただけない場合はご利用いただけません。",
                modalDisagree: "同意しない",
                modalAgree: "同意する",
                alertInitialPrompt: "先に「プロンプトを組み立てる」ボタンを押すか、メインのプロンプトを編集してください。",
                alertBatchPrompt: "先に「バリエーションを作成」ボタンを押してください。",
                aspectRatios: { '1:1 (正方形)': '1:1', '3:4 (縦長)': '3:4', '4:3 (横長)': '4:3', '9:16 (スマホ画面)': '9:16', '16:9 (ワイド画面)': '16:9' },
                aspectDownloadAll: "全てを一括ダウンロード",
                batchVariations: { '正面': "camera: straight-on front angle", '斜め前': "camera: subtle three-quarter view (≈30°)", '真横': "camera: profile side view (90°)", '斜め後ろ': "camera: rear three-quarter view (≈135°)", '真後ろ': "camera: straight-on back view (180°)", '標準': "", '暖色系': "lighting: warm key light (3500K), soft fill", '寒色系': "lighting: cool key light (6500K), crisp fill", 'ドラマチック': "lighting: dramatic high-contrast, strong key light with deep shadows, sharp rim light", 'ソフト': "lighting: soft, diffused, overcast day lighting, minimal shadows" }
            },
            en: {
                pageTitle: "Nano Banana - Illustration to Figure Prompt Builder",
                appTitle: "Prompt Builder for Nano Banana<br/>Illustration to Figure",
                appSubtitle: "Select options to build a prompt for turning illustrations into figures.",
                recSettingsTitle: "【Recommended Settings】",
                recSettingsText: "To ensure the AI accurately reflects the intent of the prompts built by this tool, it is strongly recommended to set <strong class=\"font-semibold text-amber-300\">Temperature and Top P to '0'</strong> in the Nano Banana model settings.",
                aspectRatioTitle: "Aspect Ratio",
                aspectMatch: "Match reference image",
                aspectChange: "Change aspect ratio",
                aspectDownloadDesc: "If you want to change the aspect ratio of the generated image, download the desired 'Aspect Ratio Image' from here.",
                aspectNotesTitle: "【Notes】",
                aspectNote1: "Once downloaded, each aspect ratio image can be reused.",
                aspectNote2: "Due to model characteristics, the output may not always match the specified aspect ratio exactly.",
                aspectNote3: "When changing the aspect ratio, we recommend generating with 'No Package' and 'No Background' or 'Studio Background' to prevent composition issues.",
                aspectImportantTitle: "【IMPORTANT】Upload Order in Nano Banana:",
                aspectImportantDesc: "The aspect ratio of the last uploaded image will be applied.",
                aspectImportantList: "<li><strong>Standard case:</strong><br/><span class=\"pl-4 font-mono\">1. Illustration → 2. Aspect Ratio Image</span></li><li><strong>Using a logo image:</strong><br/><span class=\"pl-4 font-mono\">1. Logo Image → 2. Illustration → 3. Aspect Ratio Image</span></li>",
                packageTitle: "Package Options",
                packageCheck: "Place package in the background",
                packageTextLabel: "Text on package:",
                packageTextInput: "e.g., Figure Name",
                packageTextureCheck: "Use reference image as texture",
                packageLogoCheck: "Add logo",
                logoTypeLabel: "Select logo type:",
                logoTypeImage: "Place logo image",
                logoTypeText: "Generate from text",
                logoImageInstructions: "<strong class=\"text-slate-200\">【IMPORTANT】How to use a logo image:</strong><br/>Upload the images in the following order in Nano Banana:<br/><strong class=\"text-amber-400 font-mono\">1. The image you want to use as a logo</strong><br/><strong class=\"text-amber-400 font-mono\">2. The illustration to be turned into a figure</strong><br/><span class=\"text-xs\">(If changing the aspect ratio, upload the aspect ratio image last)</span>",
                logoTextLabel: "Text for logo:",
                logoTextInput: "e.g., Brand Name",
                backgroundTitle: "Background Options",
                backgroundCheck: "Place background",
                backgroundTypeLabel: "Background Preset:",
                bgTypeStudio: "Studio",
                bgTypeShop: "Shop",
                bgTypeDesk: "On a desk",
                bgTypeDiorama: "Diorama",
                bgTypeOther: "Other",
                backgroundPromptLabel: "Background Prompt (Editable):",
                backgroundPromptInput: "Describe freely",
                displayBaseTitle: "Display Base",
                displayBaseUse: "Use",
                displayBaseDesc: "Turning this off will hide the display base.",
                generateButton: "Build Prompt",
                resultTitle: "Built Prompt:",
                resultSubtitle: "You can edit this prompt directly. Please copy and paste it into the Nano Banana input field.",
                copyButton: "Copy",
                copyButtonDone: "Copied!",
                variationTitle: "Variation Creation",
                variationSubtitle: "Select the type of variation you want to create.",
                variationAngle: "Camera Angle Variations",
                variationLight: "Lighting Variations",
                variationButton: "Create Variations",
                downloadButton: "Download All as .txt",
                termsTitle: "Terms of Use",
                termsHeading: "Terms and Conditions for Purchaser-Exclusive Content",
                termsList: "<li>This content is for the exclusive use of the purchaser. Any redistribution, including sharing the URL, reprinting, publishing, duplicating, or secondary distribution, is prohibited.</li><li>The user is solely responsible for all actions and results arising from the use of this content (including publishing, posting, and distributing generated materials).</li><li>Display and operation may vary depending on the environment (browser, extensions, network, etc.). We do not guarantee completeness, continuity, or suitability of operation.</li><li>The content, terms of provision, and URL are subject to change or discontinuation without notice. Access may be suspended if unauthorized use is detected.</li>",
                termsDisclaimer: "If you do not agree to the above terms, you may not use this content.",
                authorLabel: "Author: Tennen",
                modalTitle: "Terms and Conditions for Purchaser-Exclusive Content",
                modalList: "<li>This content is for the exclusive use of the purchaser. Any redistribution, including sharing the URL, reprinting, publishing, duplicating, or secondary distribution, is prohibited.</li><li>The user is solely responsible for all actions and results arising from the use of this content (including publishing, posting, and distributing generated materials).</li><li>Display and operation may vary depending on the environment (browser, extensions, network, etc.). We do not guarantee completeness, continuity, or suitability of operation.</li><li>The content, terms of provision, and URL are subject to change or discontinuation without notice. Access may be suspended if unauthorized use is detected.</li>",
                modalDisclaimer: "If you do not agree to the above terms, you may not use this content.",
                modalDisagree: "Disagree",
                modalAgree: "Agree",
                alertInitialPrompt: "Please build or edit the main prompt first.",
                alertBatchPrompt: "Please create variations first.",
                aspectRatios: { '1:1 (Square)': '1:1', '3:4 (Portrait)': '3:4', '4:3 (Landscape)': '4:3', '9:16 (Smartphone)': '9:16', '16:9 (Widescreen)': '16:9' },
                aspectDownloadAll: "Download All",
                batchVariations: { 'Front': "camera: straight-on front angle", '3/4 View': "camera: subtle three-quarter view (≈30°)", 'Side': "camera: profile side view (90°)", 'Rear 3/4': "camera: rear three-quarter view (≈135°)", 'Back': "camera: straight-on back view (180°)", 'Standard': "", 'Warm': "lighting: warm key light (3500K), soft fill", 'Cool': "lighting: cool key light (6500K), crisp fill", 'Dramatic': "lighting: dramatic high-contrast, strong key light with deep shadows, sharp rim light", 'Soft': "lighting: soft, diffused, overcast day lighting, minimal shadows" }
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ja';

        const setLanguage = (lang) => {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang;

            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.dataset.langKey;
                const type = el.dataset.langType || 'text';
                const translation = translations[lang][key];
                if (translation !== undefined) {
                    if (type === 'placeholder') {
                        el.placeholder = translation;
                    } else if (type === 'html') {
                        el.innerHTML = translation;
                    } else {
                        el.textContent = translation;
    
                    }
                }
            });
            
            // Update active button style
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
                btn.classList.toggle('bg-slate-700', btn.dataset.lang !== lang && lang === 'en');
                btn.classList.toggle('bg-slate-600', btn.dataset.lang !== lang && lang === 'ja');
            });

            // Redraw dynamic elements
            createAspectRatioButtons();
            updateBackgroundPrompt();
        };

        const createAspectRatioButtons = () => {
            const container = document.getElementById('aspect-ratio-buttons');
            container.innerHTML = '';
            const aspectRatios = translations[currentLang].aspectRatios;
            Object.entries(aspectRatios).forEach(([label, ratio]) => {
                const button = document.createElement('button');
                const buttonSpan = document.createElement('span');
                buttonSpan.textContent = `DL: ${label}`;
                
                button.className = 'bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-3 rounded-lg text-sm transition-all duration-200 flex items-center justify-center gap-2';
                button.dataset.ratio = ratio;

                const icon = `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-linecap="round" stroke-linejoin="round"></path></svg>`;
                button.innerHTML = icon;
                button.appendChild(buttonSpan);
                container.appendChild(button);
            });
        };
        
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', (e) => setLanguage(e.target.dataset.lang));
        });

        // --- Anti-Copying Measures ---
        document.addEventListener('contextmenu', (e) => {
            // Allow right-click on text areas and inputs for better UX
            if (e.target.tagName.toLowerCase() !== 'textarea' && e.target.tagName.toLowerCase() !== 'input') {
                e.preventDefault();
            }
        });
        
        // Element Definitions
        const aspectRatioSection = document.getElementById('aspect-ratio-section');
        const aspectRatioControls = document.getElementById('aspect-ratio-controls');
        const includePackageCheckbox = document.getElementById('include-package');
        const packageOptionsContainer = document.getElementById('package-options-container');
        const packageTextInput = document.getElementById('package-text');
        const useImageAsTextureCheckbox = document.getElementById('use-image-as-texture');
        const includeLogoCheckbox = document.getElementById('include-logo');
        const logoOptionsContainer = document.getElementById('logo-options-container');
        const logoImageInstructions = document.getElementById('logo-image-instructions');
        const logoTextContainer = document.getElementById('logo-text-container');
        const logoTextInput = document.getElementById('logo-text');
        const includeBackgroundCheckbox = document.getElementById('include-background');
        const backgroundOptionsContainer = document.getElementById('background-options-container');
        const backgroundPromptInput = document.getElementById('background-prompt-input');
        const generatePromptBtn = document.getElementById('generate-prompt-btn');
        const resultArea = document.getElementById('result-area');
        const promptOutput = document.getElementById('prompt-output');
        const copyPromptBtn = document.getElementById('copy-prompt-btn');

        const backgroundKeywords = {
            studio: "neutral gradient paper sweep studio, seamless backdrop (light gray to white vertical gradient), soft three-point lighting (key at 45°, gentle fill, subtle rim), soft contact shadows, faint floor reflection, a clean set without props or clutter",
            shop: "inside a hobby figure shop display case, clean glass shelves with soft reflections, neutral diffused overhead lighting, shallow background bokeh, unbranded presentation without any visible brand logos or signage, tidy presentation",
            diorama: "themed diorama scene with subtle textured ground and minimal supporting props, cohesive color palette, soft directional lighting, shallow background bokeh, tidy composition, an unbranded look without any visible brand logos",
            desk: "on a minimalist desk setup, clean wooden or matte tabletop, subtle side window light, soft ambient glow from a monitor in the distance (blurred), tidy composition, an unbranded look without any visible brand logos"
        };

        const updateBackgroundPrompt = () => {
            const selectedValue = document.querySelector('input[name="background-type"]:checked').value;
            if (selectedValue === 'other') {
                backgroundPromptInput.value = '';
                 if (translations[currentLang] && translations[currentLang].backgroundPromptInput) {
                    backgroundPromptInput.placeholder = translations[currentLang].backgroundPromptInput;
                }
            } else {
                backgroundPromptInput.value = backgroundKeywords[selectedValue];
            }
        };
        
        const downloadAspectRatioImage = (ratio) => {
            const [w, h] = ratio.split(':').map(Number);
            const canvas = document.createElement('canvas');
            canvas.width = w * 100;
            canvas.height = h * 100;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#808080';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            const link = document.createElement('a');
            link.download = `aspect_ratio_image_${w}x${h}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        };

        // --- UI Toggles ---
        includePackageCheckbox.addEventListener('change', () => {
            packageOptionsContainer.classList.toggle('hidden', !includePackageCheckbox.checked);
        });
        
        includeLogoCheckbox.addEventListener('change', () => {
            logoOptionsContainer.classList.toggle('hidden', !includeLogoCheckbox.checked);
        });

        document.querySelectorAll('input[name="logo-type"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const isImageType = e.target.value === 'image';
                logoImageInstructions.classList.toggle('hidden', !isImageType);
                logoTextContainer.classList.toggle('hidden', isImageType);
            });
        });

        includeBackgroundCheckbox.addEventListener('change', () => {
            backgroundOptionsContainer.classList.toggle('hidden', !includeBackgroundCheckbox.checked);
            if (includeBackgroundCheckbox.checked) {
                updateBackgroundPrompt();
            }
        });
        
        document.querySelectorAll('input[name="background-type"]').forEach(radio => {
            radio.addEventListener('change', updateBackgroundPrompt);
        });
        
        document.querySelectorAll('input[name="aspect-ratio-option"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const shouldShowControls = e.target.value === 'change';
                aspectRatioControls.classList.toggle('hidden', !shouldShowControls);
            });
        });
        
        
        // --- Aspect Ratio Image Generation ---
        document.getElementById('aspect-ratio-buttons').addEventListener('click', (e) => {
            let target = e.target;
            while(target && target.tagName !== 'BUTTON') {
                target = target.parentElement;
            }
            if (target && target.dataset.ratio) {
                downloadAspectRatioImage(target.dataset.ratio);
            }
        });

        document.getElementById('download-all-aspects-btn').addEventListener('click', () => {
            const aspectRatios = Object.values(translations['ja'].aspectRatios); // Use 'ja' as the base for ratios
            aspectRatios.forEach((ratio, index) => {
                setTimeout(() => {
                    downloadAspectRatioImage(ratio);
                }, index * 300); // Stagger downloads
            });
        });

        // --- Prompt Generation ---
        const generateBasePrompt = () => {
            const parts = [];
            
            const isPackage = includePackageCheckbox.checked;
            const useAsTexture = isPackage && useImageAsTextureCheckbox.checked;
            const isLogo = isPackage && includeLogoCheckbox.checked;
            const logoType = isLogo ? document.querySelector('input[name="logo-type"]:checked').value : '';
            const isLogoImage = isLogo && logoType === 'image';
            
            // Part 1: Initial instruction
            if (isLogoImage) {
                parts.push(`Using the provided images, transform the second image (the character) into a photorealistic PVC anime figure. Keep the character's design, pose, and colors exactly the same.`);
            }
            
            // Part 2: Core figure details
            parts.push("Transform this illustration into a photorealistic PVC anime figure. Keep the original character’s design, pose, and colors exactly the same. Render it as a collectible figurine made of PVC plastic, with realistic painted surface and detailed shading. Apply glossy highlights on areas such as the hair and clothing, matte finish on the skin, and subtle seam lines as seen in real manufactured figures.");

            // Part 3: Background & Staging
            if (includeBackgroundCheckbox.checked && backgroundPromptInput.value.trim()) {
                parts.push(`The background should be: ${backgroundPromptInput.value.trim()}`);
            } else {
                 parts.push("Use a neutral studio background, professional studio lighting, sharp focus, shallow depth of field, as if photographed for a catalog.");
            }

            // Part 4: Display Base
            const useBase = document.getElementById('display-base-toggle').checked;
            if (useBase) {
                parts.push("Place the figure on a simple round display base, with a soft shadow cast beneath it.");
            } else {
                parts.push("Do not include any display bases or stands.");
            }

            // Part 5: Packaging
            if (isPackage) {
                parts.push(`With its packaging box visible in the background, a plastic blister pack.`);
                if (packageTextInput.value.trim()) {
                    parts.push(`The packaging box should clearly display the printed text: "${packageTextInput.value.trim()}".`);
                }
                
                if (useAsTexture) {
                    if (isLogoImage) {
                         parts.push(`The packaging's surface should be a printed texture derived from the second image (the character illustration).`);
                    } else {
                       parts.push(`The packaging's surface should be a printed texture from the reference image.`);
                    }
                }

                if (isLogo) {
                     if (isLogoImage) {
                        parts.push(`The packaging box should also display the first uploaded image as a printed graphic on its surface.`);
                    } else if (logoType === 'text' && logoTextInput.value.trim()) {
                        parts.push(`The packaging box should also display an abstract symbol or minimal logo design with the text "${logoTextInput.value.trim()}".`);
                    }
                }
            }
            return parts.join(' ').replace(/\s+/g, ' ').trim();
        };
        
        generatePromptBtn.addEventListener('click', () => {
            promptOutput.value = generateBasePrompt();
            resultArea.classList.remove('hidden');
        });

        copyPromptBtn.addEventListener('click', () => {
            promptOutput.select();
            document.execCommand('copy');
            const textSpan = copyPromptBtn.querySelector('span');
            if(textSpan) textSpan.textContent = translations[currentLang].copyButtonDone;
            setTimeout(() => {
                 if(textSpan) textSpan.textContent = translations[currentLang].copyButton;
            }, 2000);
        });

        // --- Batch Helper ---
        const batchGenerateBtn = document.getElementById('batch-generate');
        const batchDownloadBtn = document.getElementById('batch-download');
        const batchListContainer = document.getElementById('batch-list');

        const generateBatchPrompts = (base, type) => {
            const list = [];
            const variations = translations.en.batchVariations; // Use English for prompt parts
            
            const angles = {
                [translations[currentLang].batchVariations.Front || '正面']: variations.Front,
                [translations[currentLang].batchVariations['3/4 View'] || '斜め前']: variations['3/4 View'],
                [translations[currentLang].batchVariations.Side || '真横']: variations.Side,
                [translations[currentLang].batchVariations['Rear 3/4'] || '斜め後ろ']: variations['Rear 3/4'],
                [translations[currentLang].batchVariations.Back || '真後ろ']: variations.Back,
            };

            const lights = {
                [translations[currentLang].batchVariations.Standard || '標準']: variations.Standard,
                [translations[currentLang].batchVariations.Warm || '暖色系']: variations.Warm,
                [translations[currentLang].batchVariations.Cool || '寒色系']: variations.Cool,
                [translations[currentLang].batchVariations.Dramatic || 'ドラマチック']: variations.Dramatic,
                [translations[currentLang].batchVariations.Soft || 'ソフト']: variations.Soft,
            };

            if (type === 'angle') {
                for (const [key, value] of Object.entries(angles)) {
                    list.push({ label: key, prompt: `${base} ${value}`.trim() });
                }
            } else if (type === 'light') {
                for (const [key, value] of Object.entries(lights)) {
                    list.push({ label: key, prompt: `${base} ${value}`.trim() });
                }
            }
            return list;
        };
        
        batchGenerateBtn.addEventListener('click', () => {
            const base = promptOutput.value.trim();
            if (!base) {
                alert(translations[currentLang].alertInitialPrompt);
                return;
            }

            const variationType = document.querySelector('input[name="batch-variation-type"]:checked').value;
            
            const arr = generateBatchPrompts(base, variationType);
            
            batchListContainer.innerHTML = "";
            arr.forEach(item => {
                const row = document.createElement('div');
                row.className = "relative p-2 rounded-lg bg-slate-800 border border-slate-600";
                
                const label = document.createElement('div');
                label.className = "text-xs font-semibold text-slate-400 mb-1";
                label.textContent = item.label;

                const textarea = document.createElement('textarea');
                textarea.className = "w-full text-xs bg-transparent outline-none resize-y";
                textarea.rows = 3;
                textarea.value = item.prompt;
                const btn = document.createElement('button');
                
                btn.className = "absolute top-2 right-2 bg-slate-600 hover:bg-slate-500 text-white text-xs px-2 py-1 rounded flex items-center gap-1";
                
                const copyIconHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round"></path></svg>`;

                const btnText = document.createElement('span');
                btnText.textContent = translations[currentLang].copyButton;
                
                btn.innerHTML = copyIconHTML;
                btn.appendChild(btnText);
                
                btn.addEventListener('click', () => {
                    textarea.select();
                    document.execCommand('copy');
                    btnText.textContent = translations[currentLang].copyButtonDone;
                    setTimeout(() => { btnText.textContent = translations[currentLang].copyButton; }, 1500);
                });
                row.appendChild(label);
                row.appendChild(textarea);
                row.appendChild(btn);
                batchListContainer.appendChild(row);
            });
            window._nb_batch = arr.map(item => item.prompt);
        });

        batchDownloadBtn.addEventListener('click', () => {
            const arr = window._nb_batch || [];
            if (!arr.length) {
                alert(translations[currentLang].alertBatchPrompt);
                return;
            }
            const blob = new Blob([arr.join("\n\n---\n\n")], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "batch_prompts.txt";
            a.click();
            setTimeout(() => { URL.revokeObjectURL(url); }, 1000);
        });

        
        // --- License ID Logic ---
        (function(){
            try {
                const KEY = 'nb_license_id';
                let id = localStorage.getItem(KEY);
                if (!id) {
                    const rand = (n) => Math.floor(Math.random() * n).toString(16).padStart(4, '0').toUpperCase();
                    const y = new Date().getFullYear();
                    id = `NB-${y}-${rand(0x10000)}-${rand(0x10000)}`;
                    localStorage.setItem(KEY, id);
                }
                window.nbLicenseId = id;
                window.nbUpdateLicenseIds = function() {
                    document.querySelectorAll('.license-id').forEach(el => {
                        el.textContent = window.nbLicenseId;
                    });
                };
                window.nbUpdateLicenseIds();
            } catch (e) {
                // Fallback for privacy modes
            }
        })();

        // --- Consent Modal Logic ---
        (function(){
            const overlay = document.getElementById('consent-overlay');
            const agreeBtn = document.getElementById('consent-agree');
            const disagreeBtn = document.getElementById('consent-disagree');

            const show = () => {
                overlay.classList.add('show');
                document.body.style.overflow = 'hidden';
            };
            const hide = () => {
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            };

            show();
            if(window.nbUpdateLicenseIds) window.nbUpdateLicenseIds();

            agreeBtn.addEventListener('click', hide);
            disagreeBtn.addEventListener('click', () => {
                window.close();
                if (history.length > 1) {
                    history.back();
                } else {
                    location.replace('https://note.com/munou_ac');
                }
            });
        })();

        // Initial Load
        setLanguage(currentLang);
    });
</script>
</body>
</html>
